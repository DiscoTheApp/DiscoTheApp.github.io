<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="DISCO">
        <meta name="author" content="Tushar">

        <title>DISCO</title>

        <!-- Bootstrap core CSS -->
        <link href="bootstrap.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <link href="jumbotron.css" rel="stylesheet">
        <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.css" />

        <!-- Firebase -->

        <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>  
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-messaging.js"></script>
        <script src="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.js"></script>


        <!-- Leave out Storage -->
        <!-- <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-storage.js"></script> -->

    </head>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDquIdmKQfr-QGF3kyEb28FzAboOPBE36g",
            authDomain: "disco-6a3bf.firebaseapp.com",
            databaseURL: "https://disco-6a3bf.firebaseio.com",
            storageBucket: "disco-6a3bf.appspot.com",
            messagingSenderId: "71660981931"
        };
        firebase.initializeApp(config);

        firebase.auth().signOut();

        // FirebaseUI config.
        var uiConfig = {
            signInSuccessUrl: 'index.html',
            signInOptions: [
                // Leave the lines as is for the providers you want to offer your users.
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                firebase.auth.EmailAuthProvider.PROVIDER_ID
            ],
            // Terms of service url.
            tosUrl: '<your-tos-url>'
        };

        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);


    </script>



    <!-- fireUI here -->


    <body  style = "background-color: #whitw; color: #444444" >



        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html"> DISCO </a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <form class="navbar-form navbar-right">
                        <div class="form-group">
                            <input type="text" placeholder="Email" class="form-control" id = "inputEmail">
                        </div>
                        <div class="form-group">
                            <input type="password" placeholder="Password" class="form-control" id = "inputPassword">
                        </div>
                        <button type="submit" class="btn btn-primary btn-med">Sign in</button>
                    </form>
                </div><!--/.navbar-collapse -->
            </div>
        </nav>






        <!-- Main jumbotron for a primary marketing message or call to action -->
        <div style="text-align: center; background-color: #333333; color:white" class="jumbotron">
            <div class="container">
                <h1 >WELCOME TO DISCO</h1>
                <p>Made for Artists</p>

            </div>
        </div>

        <div id="firebase-ui-container"></div>





        <div class="container">

            <h2 style="text-align: center; padding-bottom: 25px">Create Account</h2>




       




            <script>

                function startLogin (){



                    console.log("starting to create account");

                    var loginForm = document.getElementById('loginForm');

                    console.log(loginForm.inputEmail.value);
                    console.log("starting sign up");

                    var inputEmail = loginForm.inputEmail.value;
                    var inputUsername = loginForm.inputUsername.value;
                    var password = loginForm.inputPassword.value;
                    var confirmPassword = loginForm.inputConfirmPassword.value;


                    checkUsername(inputUsername);


                    console.log("SIGNING UP..");
                    console.log(inputEmail);
                    console.log("is this you?");

                    if (inputEmail.length < 4) {
                        alert('Please enter an email address.');
                        return;
                    }
                    if (password.length < 4) {
                        alert('Please enter a password.');
                        return;
                    }
                    if (password != confirmPassword) {
                        alert('Passwords do not match');
                        return;
                    }




                    console.log("about to try to create");
                    // Sign in with email and pass.
                    // [START createwithemail]
                    firebase.auth().createUserWithEmailAndPassword(inputEmail, password).catch(function(error) {
                        console.log("inside create error");
                        // Handle Errors here.
                        var errorCode = error.code;
                        var errorMessage = error.message;
                        // [START_EXCLUDE]
                        if (errorCode == 'auth/weak-password') {
                            alert('The password is too weak.');

                        } else {
                            alert(errorMessage);
                        }
                        console.log(error);
                        // [END_EXCLUDE]

                    }); // dont creating account

                    console.log("Account Created Successfully");



                    firebase.auth().onAuthStateChanged(function(user) {
                        if (user) {
                            // User is signed in.
                            var database = firebase.database();
                            user.updateProfile({
                                displayName: inputUsername
                            }).then(function() {
                                console.log("users name is: " + user.displayName)
                                // Update successful.
                            }, function(error) {
                                // An error happened.
                            });
                            console.log("About to start saving data: ");
                            firebase.database().ref('users/' + user.uid).set({
                                email: inputEmail,
                                username: inputUsername,

                            });
                            firebase.database().ref('username/'+ inputUsername).set({
                                username: user.uid,

                            });
                        } // User is signed in.

                        else {
                            // No user is signed in.
                        }
                    });

                } // end create account function

                function AvoidSpace(event) {
                    var k = event ? event.which : window.event.keyCode;
                    if (k == 32) return false;
                    if (k == 64) return false;       
                }

                function checkUsername(preUsername){

                    console.log("CHECKING USERNAMES");

                    var database = firebase.database();
                    var usernameRef = database.ref("usernames");

                    usernameRef.once('value', function(snapshot) {
                        snapshot.forEach(function(childSnapshot) {
                            var childKey = childSnapshot.key;
                            var childData = childSnapshot.val();
                            console.log(childData);

                            // ...
                        });
                    });
                }


            </script>

        </div>
        <div id="firebaseui-auth-container"></div>



        <div class= "container">
            <footer>
                <p> &copy; 2017 Hutch Limited</p>
            </footer>
        </div> <!-- /container -->

        <script>

        </script>


    </body>
</html>
