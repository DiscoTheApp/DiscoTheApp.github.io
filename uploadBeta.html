<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="DISCO">
        <meta name="author" content="Tushar">

        <title>DISCO</title>

        <!-- Bootstrap core CSS -->
        <link href="bootstrap.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <link href="jumbotron.css" rel="stylesheet">
        <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.css" />



        <!-- Firebase -->

        <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>  
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-messaging.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.7.1/firebase-storage.js"></script>
        <script src="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <script>

            var userUsername, userUid;

            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyDquIdmKQfr-QGF3kyEb28FzAboOPBE36g",
                authDomain: "disco-6a3bf.firebaseapp.com",
                databaseURL: "https://disco-6a3bf.firebaseio.com",
                storageBucket: "disco-6a3bf.appspot.com",
                messagingSenderId: "71660981931"
            };
            firebase.initializeApp(config);

            // before anything happends login code starts here

            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                    userUid = user.uid;
                    userUsername = user.displayName;


                } else {
                    // No user is signed in.
                    window.open("createAccount.html", "_self");  

                }
            });



        </script>

    </head>


    <body  style = "background-color: #222">
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.html"> DISCO </a>
                </div>
                <div class="navbar-right">
                    <a class="navbar-brand" href="upload.html"> Upload </a>
                    <a class="navbar-brand" href="feed.html"> Feed </a>
                    <a class="navbar-brand" href="myMusic.html"> My Music </a>
                    <a class="navbar-brand" href="myProfile.html"> Username </a> 


                </div>
            </div>
        </nav>



        <div class="container">
            <div class="jumbotron" style="background-color:#333;text-align: center">
                <h2 style="color: #D7B659">Upload Music</h2>
                <h3 style="color: white"> <i> Disco provides a way for artist to share their music like never before</i></h3>
                <button class="btn btn-primary" style="margin-top:10px"> HOW IT WORKS</button>

            </div>

            <div class="col-xs-6 col-md-4">

                <img  src="Images/coverArt.png" class ="square-large" style="margin-bottom: 10px" onclick="startCoverUpload()" id="coverArt">

                <select name="uploadType" class="formSelect-control" onchange="toggleType(this)">
                    <option value="single">Single</option>
                    <option value="album">Album</option>
                </select>


            </div>
            <div class="col-xs-12 col-sm-6 col-md-8" style="background-color: #222"> 


                <div id="singleDiv" style="color: white">



                    <input type="text" class="formDetails-control" placeholder="Song Name" style="width: 100%; height: 75px; font-size: 50px" id="songTextbox" onkeyup="updateSongName()" > <br>
                    <input type="text" class="formDetails-control" placeholder="#Keywords (Recommended)" style="width: 100%"> <br>
                    <input type="text" class="formDetails-control" placeholder="@Featuring Artists (Optional)" style="width: 100%"> <br>





                    <input type="file" id = "songFile" style="display: none;" accept="audio/*" onchange="handleSongSelect(this)" />
                    <input type="file" id = "coverFile" style="display: none;" accept="image/*" onchange="handleCoverSelect(this)" /> <br>



                    <button class="btn btn-primary" style="margin-top:0px; margin-right: 10px; display: none;" onclick="startSongUpload()" id="uploadButton">+ Upload Song </button> 








                    <button class="btn btn-primary btn-lg" style="display: none; float: right" id="previewButton" onclick="previewUpload()">Preview Upload</button>




                    <div id="albumDiv" style="color: white; display: none">





                    </div>




                </div>

            </div>
        </div>




        <footer class="footer">

            <audio id="player" style="display: none"></audio>

            <div class="col-xs-6 col-md-4" style="padding-left:0px">
                <img id="footerCover" class="footerCover" style="float:left; margin-right: 10px"> 

                <h3 style="margin-top:2%; color: #D7B659; margin-bottom:1%" id="footerName"> Song Name</h3>
                <i> <h4 style="margin-top: 2%; margin-bottom: 1%; color: white" id="artistName"></h4></i>
            </div>

            <div class="col-xs-6 col-md-4" style="padding-top: 1%; display: none" id="controller">

                <img  id="repeatButton"class="audioIconSmall" src="Icons/Repeat-96.png" onclick="">
                <img  id="rewindButton"class="audioIconBig" src="Icons/Rewind-100.png" onclick="">
                <img  id="playButton"class="audioIconBig" src="Icons/Play-100.png" onclick="toggleMusic()">
                <img  id="forwardButton"class="audioIconBig" src="Icons/Fast%20Forward-100.png" onclick="">
                <img  id="shuffleButton"class="audioIconSmall" src="Icons/Shuffle-96.png" onclick="">

            </div>

            <div class="col-xs-6 col-md-4" style="float: right;margin-top: 1%">

                <button class="btn btn-primary btn-lg">Publish</button>

            </div>






        </footer>









        <script>


            var storageRef = firebase.storage().ref();
            var songName, songFile, coverFile;

            var player = document.getElementById('player');
            var controller =  document.getElementById('controller');
            var uploadButton = document.getElementById('uploadButton');
            var previewButton = document.getElementById('previewButton');
            var songPreview = document.getElementById('songPreview');
            var playButton = document.getElementById('playButton');
            var artistNameId = document.getElementById('artistName');
            var footerName = document.getElementById('footerName');
            var inputSong = document.getElementById('songTextbox')



            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {

                    return firebase.database().ref('/users/' + userUsername + "/publicName").once('value').then(function(snapshot) {
                        var artistName = snapshot.val()
                        document.getElementById("artistName").innerHTML = artistName;



                    });


                } else {
                    // No user is signed in.
                    window.open("createAccount.html", "_self");  

                }
            });





            function toggleType(el){
                var value = el.options[el.selectedIndex].value,
                    singleDiv = document.getElementById('singleDiv'),
                    albumDiv  = document.getElementById('albumDiv');

                if (value === 'single') {
                    singleDiv.style.display = 'block';
                    albumDiv.style.display = 'none';

                } else if (value === 'album') {
                    singleDiv.style.display = 'none';
                    albumDiv.style.display = 'block';   

                }
            }

            function handleSongSelect(input) {
                console.log("ready to upload for: " + userUsername);
                console.log("file chosen");
                if (input.files && input.files[0]) {
                    console.log("file exists");
                    var songFile = input.files[0];

                    if (songFile){
                        controller.style.display = 'block';

                    }

                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#player')
                            .attr('src', e.target.result);
                    };

                    reader.readAsDataURL(input.files[0]);
                }

            } // END FILE SELECT

            function handleCoverSelect(input) {
                console.log("file chosen");
                if (input.files && input.files[0]) {
                    console.log("file exists");
                    coverFile = input.files[0];

                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#coverArt')
                            .attr('src', e.target.result);
                        $('#footerCover')
                            .attr('src', e.target.result);
                    };

                    reader.readAsDataURL(input.files[0]);
                }



            } // END FILE SELECT

            function startSongUpload(){
                document.getElementById('songFile').click();

            }
            function startCoverUpload(){
                document.getElementById('coverFile').click();

            }

            function nameExists(event){
                songName = event.target.value;

                if (songName.length > 0){
                    uploadButton.style.display = 'block';


                }
                if (songName.length == 0){
                    uploadButton.style.display = 'none';

                }

            }




            function toggleMusic(){
                console.log("clicked");
                if (player.paused){
                    player.play();  
                    $('#playButton').attr('src', "Icons/Pause-100.png");
                }
                else{
                    player.pause();
                    $('#playButton').attr('src', "Icons/Play-100.png");
                }


            }

            function updateSongName(){
                footerName.innerHTML =  inputSong.value;

            }





            window.onload = 

                function() {
                inputSong.addEventListener('input', nameExists,false);

            }

        </script>



    </body>

</html>